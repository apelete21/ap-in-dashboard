import React, { useContext, useEffect, useState } from 'react'
import { icons } from '../service/icons'
import Visits, { dataExtraction } from "../components/charts/Visits"
import HomeQuotesList from '../components/quotes/HomeQuotesList'
import { LineComponent } from '../components/charts/Line'
import { Helmet } from 'react-helmet'
import moment from 'moment'
import { months } from "../components/charts/Visits"
import Gauge from '../components/charts/Gauge'
import { articleReq } from '../requests/article'
import { AppContext } from '../Contexts/AppContext'
import { LoadingComp } from '../components/loading' 

export default function Home() {
  const { setStatusMessage } = useContext(AppContext)
  const [isLoading, setIsLoading] = useState(true)
  const [posts, setPosts] = useState([])
  const [yValues, setYValues] = useState([])
  const [loading, setLoading] = useState(true)
  useEffect(() => {
    (async () => {
      setYValues(await dataExtraction("news"))
    })()
    setLoading(false)
  }, [loading])
  
  useEffect(() => {
    (async () => {
      if (isLoading) {
        try {
          const { data, ok } = await articleReq("GET", "");
          if (ok) {
            setPosts(data);
          }
        } catch (error) {
          setStatusMessage("An error occured!");
        }
      }
      setIsLoading(false);
    })();
  })

  return (
    <>
      <Helmet>
        <title>Bienvenue | Dashboard</title>
      </Helmet>
      <Visits />

      <div className="stats_chart">
        <div className="blog_stats">
          <div className="title">
            <h2>
              <b>Blog activity</b>
            </h2>
          </div>
          <div className="circular_chart">
            {/* <svg width="189" height="152" viewBox="0 0 189 152" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path
                d="M9.22119 109.575C9.12454 109.171 8.9488 108.868 8.69398 108.666C8.43916 108.464 8.08329 108.362 7.62637 108.362C6.93221 108.362 6.41378 108.63 6.0711 109.166C5.72841 109.694 5.54828 110.572 5.5307 111.803C5.75916 111.416 6.09306 111.117 6.53241 110.906C6.97175 110.695 7.44624 110.59 7.95588 110.59C8.53582 110.59 9.04546 110.717 9.4848 110.972C9.93293 111.218 10.28 111.578 10.526 112.053C10.7809 112.527 10.9083 113.094 10.9083 113.753C10.9083 114.368 10.7853 114.917 10.5392 115.401C10.302 115.884 9.94611 116.266 9.47162 116.547C8.99713 116.82 8.42598 116.956 7.75818 116.956C6.85313 116.956 6.14139 116.758 5.62296 116.363C5.11332 115.959 4.75306 115.392 4.54218 114.663C4.34008 113.933 4.23903 113.024 4.23903 111.934C4.23903 108.718 5.37254 107.11 7.63955 107.11C8.51824 107.11 9.20801 107.348 9.70887 107.822C10.2185 108.297 10.5173 108.881 10.6051 109.575H9.22119ZM7.62637 111.855C7.09037 111.855 6.63346 112.018 6.25562 112.343C5.88657 112.659 5.70205 113.121 5.70205 113.727C5.70205 114.333 5.87339 114.816 6.21608 115.177C6.56755 115.528 7.05523 115.704 7.6791 115.704C8.23267 115.704 8.66762 115.533 8.98395 115.19C9.30906 114.847 9.47162 114.39 9.47162 113.819C9.47162 113.222 9.31346 112.747 8.99713 112.396C8.68959 112.035 8.23267 111.855 7.62637 111.855ZM12.511 112.027C12.511 110.506 12.7658 109.32 13.2755 108.468C13.7939 107.607 14.6814 107.176 15.9379 107.176C17.1944 107.176 18.0775 107.607 18.5872 108.468C19.1056 109.32 19.3648 110.506 19.3648 112.027C19.3648 113.564 19.1056 114.768 18.5872 115.638C18.0775 116.499 17.1944 116.93 15.9379 116.93C14.6814 116.93 13.7939 116.499 13.2755 115.638C12.7658 114.768 12.511 113.564 12.511 112.027ZM17.8886 112.027C17.8886 111.315 17.8403 110.713 17.7436 110.221C17.6557 109.729 17.4712 109.329 17.19 109.021C16.9089 108.705 16.4915 108.547 15.9379 108.547C15.3843 108.547 14.967 108.705 14.6858 109.021C14.4046 109.329 14.2157 109.729 14.119 110.221C14.0312 110.713 13.9872 111.315 13.9872 112.027C13.9872 112.765 14.0312 113.384 14.119 113.885C14.2069 114.386 14.3914 114.79 14.6726 115.098C14.9626 115.405 15.3843 115.559 15.9379 115.559C16.4915 115.559 16.9089 115.405 17.19 115.098C17.48 114.79 17.6689 114.386 17.7568 113.885C17.8447 113.384 17.8886 112.765 17.8886 112.027ZM20.7174 109.667C20.7174 109.026 20.9019 108.525 21.271 108.165C21.6488 107.796 22.1321 107.611 22.7208 107.611C23.3096 107.611 23.7884 107.796 24.1575 108.165C24.5353 108.525 24.7242 109.026 24.7242 109.667C24.7242 110.309 24.5353 110.814 24.1575 111.183C23.7884 111.552 23.3096 111.737 22.7208 111.737C22.1321 111.737 21.6488 111.552 21.271 111.183C20.9019 110.814 20.7174 110.309 20.7174 109.667ZM28.7574 107.783L23.4985 116.956H22.0223L27.2812 107.783H28.7574ZM22.7208 108.521C22.1673 108.521 21.8905 108.903 21.8905 109.667C21.8905 110.441 22.1673 110.827 22.7208 110.827C22.9844 110.827 23.1865 110.735 23.3271 110.55C23.4765 110.357 23.5512 110.063 23.5512 109.667C23.5512 108.903 23.2744 108.521 22.7208 108.521ZM26.0818 115.058C26.0818 114.417 26.2663 113.916 26.6354 113.556C27.0132 113.186 27.4965 113.002 28.0852 113.002C28.6652 113.002 29.1397 113.186 29.5087 113.556C29.8865 113.916 30.0755 114.417 30.0755 115.058C30.0755 115.7 29.8865 116.205 29.5087 116.574C29.1397 116.943 28.6652 117.127 28.0852 117.127C27.4965 117.127 27.0132 116.943 26.6354 116.574C26.2663 116.205 26.0818 115.7 26.0818 115.058ZM28.072 113.911C27.5185 113.911 27.2417 114.294 27.2417 115.058C27.2417 115.823 27.5185 116.205 28.072 116.205C28.6256 116.205 28.9024 115.823 28.9024 115.058C28.9024 114.294 28.6256 113.911 28.072 113.911Z"
                fill="#666666" />
              <path
                d="M160.113 114.953V113.819L164.541 107.466H166.36V113.648H167.586V114.953H166.36V116.956H164.884V114.953H160.113ZM164.95 108.995L161.839 113.648H164.95V108.995ZM168.831 112.027C168.831 110.506 169.086 109.32 169.595 108.468C170.114 107.607 171.001 107.176 172.258 107.176C173.514 107.176 174.397 107.607 174.907 108.468C175.425 109.32 175.685 110.506 175.685 112.027C175.685 113.564 175.425 114.768 174.907 115.638C174.397 116.499 173.514 116.93 172.258 116.93C171.001 116.93 170.114 116.499 169.595 115.638C169.086 114.768 168.831 113.564 168.831 112.027ZM174.208 112.027C174.208 111.315 174.16 110.713 174.063 110.221C173.976 109.729 173.791 109.329 173.51 109.021C173.229 108.705 172.811 108.547 172.258 108.547C171.704 108.547 171.287 108.705 171.006 109.021C170.724 109.329 170.536 109.729 170.439 110.221C170.351 110.713 170.307 111.315 170.307 112.027C170.307 112.765 170.351 113.384 170.439 113.885C170.527 114.386 170.711 114.79 170.992 115.098C171.282 115.405 171.704 115.559 172.258 115.559C172.811 115.559 173.229 115.405 173.51 115.098C173.8 114.79 173.989 114.386 174.077 113.885C174.165 113.384 174.208 112.765 174.208 112.027ZM177.037 109.667C177.037 109.026 177.222 108.525 177.591 108.165C177.969 107.796 178.452 107.611 179.041 107.611C179.629 107.611 180.108 107.796 180.477 108.165C180.855 108.525 181.044 109.026 181.044 109.667C181.044 110.309 180.855 110.814 180.477 111.183C180.108 111.552 179.629 111.737 179.041 111.737C178.452 111.737 177.969 111.552 177.591 111.183C177.222 110.814 177.037 110.309 177.037 109.667ZM185.077 107.783L179.818 116.956H178.342L183.601 107.783H185.077ZM179.041 108.521C178.487 108.521 178.21 108.903 178.21 109.667C178.21 110.441 178.487 110.827 179.041 110.827C179.304 110.827 179.506 110.735 179.647 110.55C179.796 110.357 179.871 110.063 179.871 109.667C179.871 108.903 179.594 108.521 179.041 108.521ZM182.402 115.058C182.402 114.417 182.586 113.916 182.955 113.556C183.333 113.186 183.816 113.002 184.405 113.002C184.985 113.002 185.46 113.186 185.829 113.556C186.206 113.916 186.395 114.417 186.395 115.058C186.395 115.7 186.206 116.205 185.829 116.574C185.46 116.943 184.985 117.127 184.405 117.127C183.816 117.127 183.333 116.943 182.955 116.574C182.586 116.205 182.402 115.7 182.402 115.058ZM184.392 113.911C183.838 113.911 183.562 114.294 183.562 115.058C183.562 115.823 183.838 116.205 184.392 116.205C184.945 116.205 185.222 115.823 185.222 115.058C185.222 114.294 184.945 113.911 184.392 113.911Z"
                fill="#666666" />
              <g filter="url(#filter0_d_43_621)">
                <ellipse cx="93.5527" cy="93.7027" rx="38.5995" ry="38.4976" fill="#434445" />
              </g>
              <ellipse opacity="0.2" cx="93.5522" cy="93.7022" rx="30.1265" ry="30.0469" fill="#898989" />
              <path
                d="M87.0829 102.538C91.3385 105.503 97.2195 104.462 100.192 100.218C101.085 98.9434 101.65 97.4576 101.828 95.914L103.506 79.9875C103.528 79.7753 103.433 79.5678 103.257 79.4454C103.082 79.323 102.854 79.3053 102.662 79.3994L88.2403 86.4528C86.8532 87.1482 85.6489 88.189 84.7565 89.4631C81.7837 93.7074 82.8274 99.5728 87.0829 102.538ZM95.1701 90.9916C97.2979 92.4741 97.8197 95.4068 96.3333 97.5289C94.8469 99.6511 91.9064 100.172 89.7787 98.689C87.6509 97.2066 87.1291 94.2739 88.6155 92.1517C90.1019 90.0296 93.0423 89.5091 95.1701 90.9916Z"
                fill="#FFECF1" />
              <path
                d="M0 94.293C0 78.2226 4.13554 62.4211 12.0108 48.4009C19.8861 34.3806 31.2375 22.611 44.9786 14.2183C58.7197 5.82566 74.3906 1.09091 90.4915 0.467233C106.592 -0.156446 122.584 3.35182 136.937 10.6563L122.402 39.0652C112.924 34.2419 102.364 31.9253 91.7326 32.3371C81.1007 32.749 70.7527 35.8755 61.6791 41.4174C52.6054 46.9593 45.1098 54.7311 39.9095 63.9891C34.7092 73.2471 31.9784 83.6812 31.9784 94.293H0Z"
                fill="#FF4133" />
              <path
                d="M188.29 94.2933C188.29 77.811 183.94 61.6191 175.677 47.3451C167.414 33.071 155.53 21.2177 141.218 12.9766L125.229 40.5975C134.679 46.0394 142.527 53.8665 147.983 63.292C153.439 72.7176 156.312 83.4096 156.312 94.2933H188.29Z"
                fill="#DC3635" fillOpacity="0.11" />
              <defs>
                <filter id="filter0_d_43_621" x="36.1241" y="36.376" width="114.857" height="114.653"
                  filterUnits="userSpaceOnUse" colorInterpolationFilters="sRGB">
                  <feFlood floodOpacity="0" result="BackgroundImageFix" />
                  <feColorMatrix in="SourceAlpha" type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
                  <feOffset />
                  <feGaussianBlur stdDeviation="9.41452" />
                  <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.15 0" />
                  <feBlend mode="normal" in2="BackgroundImageFix"
                    result="effect1_dropShadow_43_621" />
                  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_43_621"
                    result="shape" />
                </filter>
              </defs>
            </svg> */}
             <Gauge />
          </div>

          <div className="chart_numbers">
            <div className="blog_stat">
              <p>Blog posts </p>
              <div className="stat_value">{posts?.length}</div>
            </div>
            <div className="blog_stat">
              <p>Mothly traffic</p>
              <div className="stat_value">{yValues[5]}
                {/* <span> 12%</span> */}
              </div>
            </div>
          </div>

        </div>

        <div className="monthly_activity">
          <div className="chart_header">
            <h2>Monthly activity board</h2>
            <div className="right_conent">
              <span className="dash"></span>
              {/* <div className="prev_month">
                <p>Previous motnth</p>
              </div> */}
              <div className="current_month">
                <p> {`${months.at(moment().month())} ${moment().year()}`} </p>
                <span>
                  <img src={icons.grayCalendar} alt="calendar" />
                </span>
              </div>
              <div className="options" style={{ opacity: 0 }}>
                <img src={icons.dotIcon} alt="" />
              </div>
            </div>

          </div>
          <div className="activity_chart">
            <LineComponent />
          </div>
        </div>
      </div>

      <HomeQuotesList />
    </>
  )
}
